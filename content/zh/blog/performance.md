---
title: "性能规划概述"
linkTitle: "性能规划概述"
date: 2017-07-20
description: >
  本文偏性能规划整体概述，后续会有一系列文章阐述具体如何进行性能优化
---

## 大纲

+ Why: 背景
+ What: 现状+目标
+ How: 规划
+ When: 具体计划

---

## Why: 背景

+ 随着网站各种大促、活动的频繁开展，暴露出一系列问题
    + 交易线上各应用性能基线缺失、水位不明
    + 代码性能差、慢sql等隐患丛生
    + 严重影响客户体验、甚至稳定性
    + ...

---

## What: 现状

+ 已完成
    - 基于问题驱动解决了部分RT高及超时问题
    - 已完成线下压测及内部单链路压测
+ 未完成
    - 水位不清楚，尚未建立完整的全链路压测体系
    - 缺乏有效性能检测、报警机制

---

## What: 目标

+ 构建<font color="red">体系化解决方案</font>，及时发现并解决性能问题
  - 立足交易，纵观全局，<font color="red">提升用户体验</font>
  - 构建<font color="red">"预发-发现-解决"</font>闭环，形成通用解决方案
+ 沉淀性能分析<font color="red">案例集和规范、思路、方案</font>等

---

## How: 规划

+ 建立可度量指标及相关<font color="red">监控</font>，推动系统优化
+ 全链路<font color="red">压测</font>、建立<font color="red">性能基线</font>，压测常态化
+ 沉淀相关<font color="red">案例集</font>，提供多种场景的性能方案
+ 制定相关<font color="red">机制</font>，确保可持续改进

Note:

当前重点: 全链路压测、建立性能基线

---

## When: 具体计划

+ Where：链路（前后端、上下游、应用自身）；资源(DB、NetWork、IO、Memory、CPU);
+ How：预防、定位、处理
    + 优化层次：
        - 架构: 拆分+负载均衡、逐级拦截无效请求、限流、降级
        - 算法：并行（无依赖，缩短RT）、无锁（读多些少，CAS无锁）、异步（分离主次流程）；增量式算法；空间换时间（缓存）；时间换空间（压缩）
        - 代码：实现是否合理（循环里面调用RPC、缓存、SQL）；无效对象；ArrayList、HashMap初始值；循环；合适数据结构（如读多些少，COW；StringBuffer、StringBuilder）；全局共享对象（恶汉模式）；DB尽量小结构，枚举tinyinit, 避免select *, 合适索引（频繁度、最左前缀、字符串截取），字段尽量Not Null；局部性原理（二维数据，行访问）；缓存（时效性要求不高，高的话需要考虑一致性问题）；
+ When：构建、启动、运行

---

## 预防: 全链路压测

+ 压测目标
  + 流量&QPS模型
+ 压测方案
  + 场景及链路梳理
  + 业务改造
  + 压测脚本准备
+ 压测执行
+ 压测调优
+ 总结: 压测方案标准化+问题

---

## 发现: 性能监控

+ 链路RT监控
+ 切面监控
  - 应用监控(页面, SQL, JVM etc)
  - 系统监控(CPU, 内存, 磁盘, 网络 etc)
  - 业务指标监控(RT, 失败率等)
+ 基于监控的报表统计+预警
  - 智能分析辅助定位
+ 监控汇总

---

## 处理: 迭代优化，持续改进

+ 首先优化核心链路
    - 下单、支付...
+ 按投入产出比逐步优化各系统

+ 注: 建立可度量标准，产出性能周/月报

---

## 方案: 知识沉淀

+ 案例集
+ 常见排查工具
+ 定位手段/思路、解决方案
+ 专题分享与总结
  - 前端、网络、服务端、JVM、数据库、容器等
+ 性能规范
