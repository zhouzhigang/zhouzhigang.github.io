---
title: "全球化架构思考"
linkTitle: "全球化架构思考"
date: 2019-11-16
description: >
  为什么要做全球化？会面临哪些问题？有哪些技术和业务挑战？
---

+ 为什么要做全球化？全球化、国际化、本地化的区别？
+ 全球化会面临哪些问题？有哪些技术和业务挑战？
    + 问题的本质是什么？区域化、单元化等解决方案是一个好的名字或抽象吗？
    + 应用是否要对等部署？分布式、集中式、混合式？业界或其他团队有哪些方案？我们如何选择？是否是最终方案？
    + 数据是否要对等？有哪些数据？数据如何同步？星型、P2P型、环形？单向/双向/选择性同步？判断标准是什么？
    + 如何保证数据一致性（锁/路由/混合自动冲突解决方案/分布式协同等如何取舍）？如何确定数据的读写策略？各层都是如何保证的？
        - 如果采取路由策略的话，海量数据下路由表如何设计？可靠性如何保证？变更中的一致性？
    + 具体到我们的业务上又有哪些特性需要考虑？落地时具体的指导原则（routeId谁来定、如何定等）？
    + 如果有中心化服务（如库存、营销、额度等）导致跨区域访问，从而造成性能问题，如何解？
    + 如何平滑过渡和迁移？会有哪些潜在的问题？混合架构下如何容灾？过程中的一致性如何保证？
    + ......

## 全球化架构背景

* 业务：业务开始按地域重点突破
    * 全球买、全球卖、全球运
    * **海外买家体验**需要提升（数据支撑？？延时？失败率？）
* 全球范围的流量与数据调度能力应对**政策/法规**风险
    * 技术：集团基础设施云化发展
    * 淘宝单元化与AE区域化已沉淀丰富的经验

## 全球化架构建设的思路

### 架构原则

* 优先数据一致
* 体验优先级


## 核心问题及方案

### 部署架构

* 同一套代码 or 不同代码？
  * 同一套代码：
  * 不同代码：
  * 决策：使用同一套代码部署
* 对称部署 or 非对称部署？
  * 对称部署：简单
  * 非对称部署：
  * 决策：大部分应用对称部署
* 中心（星型）or 去中心（P2P or 环形）？
  * 中心：
  * 去中心

### 数据同步

* 双向同步 or 单向同步？

### 一致性保证

原则：单一Master、优先级

> 主要是判断读写到底发生在何处？中心 or 区域？从读写两个角度分别考虑即可。

* 写
  * 单一写
    * 区域写：地址
  * 多方写
    * 一方创建，另外一方修改
      * 区域写：发货单、验货单
    * 各角色都有可能创建和修改
      * 中心写：库存、额度
        * 为了性能考虑，也可以拆分到各区域进行区域读写（成本高）
      * 区域写：Tracking
* 读
  * 非强一致/实时性要求不高
    * 区域读
  * 强一致/实时一致
    * 跨区域读

> Note: 大部分文档定义 只读、共享、自产自销、自产共销、共产共销 等概念理解起来毕竟费力

### 依赖服务

* 集团内部服务（如其他BU）只在某些区域提供服务
  * Skywalker同步
* 外部服务商服务只在某一区域提供服务
  * Local业务模式，本地业务闭环
    * 无需改造，调用只会发生在某个区域内
  * Global业务模式，全球业务调用
    * 推荐服务商上在其他区域上云（服务商成本略高）
    * 根据服务商id路由（目前服务商不再aliId体系内）
    * 封装服务商服务，指定区域